{% extends "layout.html" %}

{% block title %}How It Works{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card shadow mb-4">
            <div class="card-header bg-info text-white">
                <h3 class="my-0"><i class="fas fa-cogs me-2"></i>How MesoNet Detects DeepFakes</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h4>What is MesoNet?</h4>
                        <p>
                            MesoNet is a deep learning model specifically designed to detect facial manipulations in images, 
                            particularly those created by deepfake algorithms. The name "Meso" comes from its focus on the 
                            mesoscopic properties of imagesâ€”features that exist between the microscopic pixel level and 
                            the macroscopic image level.
                        </p>
                        
                        <h4 class="mt-4">Why MesoNet Works</h4>
                        <p>
                            Deepfake algorithms often leave subtle traces in the images they create. While these artifacts 
                            are typically invisible to the human eye, neural networks like MesoNet can be trained to identify these patterns.
                        </p>
                        <p>
                            Some common artifacts that MesoNet detects include:
                        </p>
                        <ul>
                            <li>Inconsistent noise patterns across the image</li>
                            <li>Unnatural blending boundaries</li>
                            <li>Color inconsistencies in facial features</li>
                            <li>Unusual texture patterns in skin regions</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <img src="https://images.unsplash.com/photo-1612066473428-fb6833a0d855" alt="AI Detection Visualization" class="img-fluid rounded mb-4">
                        
                        <div class="alert alert-info">
                            <h5><i class="fas fa-lightbulb me-2"></i>Did You Know?</h5>
                            <p class="mb-0">
                                MesoNet's architecture is relatively compact, with only a few convolutional layers,
                                making it efficient to run while still achieving high accuracy on many types of deepfakes.
                            </p>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <h4>The Detection Process</h4>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="detection-process">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="process-step">
                                        <div class="icon-wrapper bg-primary">
                                            <i class="fas fa-upload fa-2x text-white"></i>
                                        </div>
                                        <h5 class="mt-3">1. Image Upload</h5>
                                        <p>User uploads an image containing a face</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="process-step">
                                        <div class="icon-wrapper bg-success">
                                            <i class="fas fa-crop-alt fa-2x text-white"></i>
                                        </div>
                                        <h5 class="mt-3">2. Preprocessing</h5>
                                        <p>Image is resized and normalized</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="process-step">
                                        <div class="icon-wrapper bg-warning">
                                            <i class="fas fa-brain fa-2x text-white"></i>
                                        </div>
                                        <h5 class="mt-3">3. Analysis</h5>
                                        <p>MesoNet analyzes the image</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="process-step">
                                        <div class="icon-wrapper bg-danger">
                                            <i class="fas fa-check-circle fa-2x text-white"></i>
                                        </div>
                                        <h5 class="mt-3">4. Result</h5>
                                        <p>Classification as real or fake</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card shadow mb-4">
            <div class="card-header bg-dark">
                <h3 class="my-0"><i class="fas fa-network-wired me-2"></i>MesoNet Architecture</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h4>Neural Network Structure</h4>
                        <p>
                            MesoNet uses a Convolutional Neural Network (CNN) architecture with the following structure:
                        </p>
                        
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Layer</th>
                                        <th>Type</th>
                                        <th>Parameters</th>
                                        <th>Output Shape</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Input</td>
                                        <td>Input Layer</td>
                                        <td>-</td>
                                        <td>(256, 256, 3)</td>
                                    </tr>
                                    <tr>
                                        <td>Conv1</td>
                                        <td>Convolution + BatchNorm + ReLU</td>
                                        <td>3x3, 8 filters</td>
                                        <td>(256, 256, 8)</td>
                                    </tr>
                                    <tr>
                                        <td>Pool1</td>
                                        <td>Max Pooling</td>
                                        <td>2x2</td>
                                        <td>(128, 128, 8)</td>
                                    </tr>
                                    <tr>
                                        <td>Conv2</td>
                                        <td>Convolution + BatchNorm + ReLU</td>
                                        <td>5x5, 8 filters</td>
                                        <td>(128, 128, 8)</td>
                                    </tr>
                                    <tr>
                                        <td>Pool2</td>
                                        <td>Max Pooling</td>
                                        <td>2x2</td>
                                        <td>(64, 64, 8)</td>
                                    </tr>
                                    <tr>
                                        <td>Conv3</td>
                                        <td>Convolution + BatchNorm + ReLU</td>
                                        <td>5x5, 16 filters</td>
                                        <td>(64, 64, 16)</td>
                                    </tr>
                                    <tr>
                                        <td>Pool3</td>
                                        <td>Max Pooling</td>
                                        <td>2x2</td>
                                        <td>(32, 32, 16)</td>
                                    </tr>
                                    <tr>
                                        <td>Conv4</td>
                                        <td>Convolution + BatchNorm + ReLU</td>
                                        <td>5x5, 16 filters</td>
                                        <td>(32, 32, 16)</td>
                                    </tr>
                                    <tr>
                                        <td>Pool4</td>
                                        <td>Max Pooling</td>
                                        <td>4x4</td>
                                        <td>(8, 8, 16)</td>
                                    </tr>
                                    <tr>
                                        <td>Flatten</td>
                                        <td>Flatten</td>
                                        <td>-</td>
                                        <td>(1024)</td>
                                    </tr>
                                    <tr>
                                        <td>Dense1</td>
                                        <td>Fully Connected + ReLU</td>
                                        <td>16 units</td>
                                        <td>(16)</td>
                                    </tr>
                                    <tr>
                                        <td>Output</td>
                                        <td>Fully Connected + Sigmoid</td>
                                        <td>1 unit</td>
                                        <td>(1)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="my-0">Model Performance</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="accuracyChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="my-0">Key Features</h5>
                            </div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Compact Design:</strong> Only 8 layers total</li>
                                    <li><strong>Efficient:</strong> Only 27,977 parameters</li>
                                    <li><strong>Fast:</strong> < 2 seconds per image</li>
                                    <li><strong>Portable:</strong> Small enough for web deployment</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-12">
                        <h4>Want to Learn More?</h4>
                        <div class="d-grid gap-2 d-md-flex">
                            <a href="{{ url_for('convolution') }}" class="btn btn-info">
                                <i class="fas fa-play me-2"></i>Interactive Convolution Demo
                            </a>
                            <a href="{{ url_for('gallery') }}" class="btn btn-primary">
                                <i class="fas fa-images me-2"></i>Explore Example Images
                            </a>
                            <a href="{{ url_for('quiz') }}" class="btn btn-success">
                                <i class="fas fa-question-circle me-2"></i>Test Your Knowledge
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Create accuracy chart
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('accuracyChart').getContext('2d');
        
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Original', 'DeepFakes', 'Face2Face', 'FaceSwap', 'NeuralTextures'],
                datasets: [{
                    label: 'Detection Accuracy (%)',
                    data: [95.23, 93.45, 92.80, 94.76, 89.21],
                    backgroundColor: 'rgba(40, 167, 69, 0.2)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                    tension: 0.2
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 80,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Accuracy (%)'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Accuracy by Manipulation Type'
                    }
                }
            }
        });
    });
</script>

<style>
    .icon-wrapper {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 80px;
        height: 80px;
        border-radius: 50%;
    }
    
    .process-step {
        padding: 20px 10px;
        border-radius: 5px;
        transition: all 0.3s ease;
    }
    
    .process-step:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}
